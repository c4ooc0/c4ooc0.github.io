<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#B0C4DE" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#B0C4DE" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 5.4.2">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#B0C4DE">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"c4ooc0.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.13.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="文章大量内容参考了这本书： 内容不是很深，语言清晰易懂，看起来不太费劲，但颇有收获 还有 NMAP 参考指南： 对于 NMAP 的使用方法介绍了很多，但原理不是很清晰">
<meta property="og:type" content="article">
<meta property="og:title" content="扫描技术小记">
<meta property="og:url" content="https://c4ooc0.github.io/2022/07/14/%E6%89%AB%E6%8F%8F%E6%8A%80%E6%9C%AF%E5%B0%8F%E8%AE%B0/index.html">
<meta property="og:site_name" content="c4ooc0个人博客">
<meta property="og:description" content="文章大量内容参考了这本书： 内容不是很深，语言清晰易懂，看起来不太费劲，但颇有收获 还有 NMAP 参考指南： 对于 NMAP 的使用方法介绍了很多，但原理不是很清晰">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/c4ooc0/blog-image/blog/images/Fi-1aE8NjmAZsqQF6Gi0OmOq9IKn.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/c4ooc0/blog-image/blog/images/FhVkgrolRppCmHsB5nvPhisZ1qa_.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/c4ooc0/blog-image/blog/images/Ftyb7oUY-TYhQe9rQpIFr2b6GHD4.png">
<meta property="article:published_time" content="2022-07-14T00:55:56.000Z">
<meta property="article:modified_time" content="2022-11-10T08:45:47.765Z">
<meta property="article:author" content="c4ooc0">
<meta property="article:tag" content="安全 瞎折腾">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/c4ooc0/blog-image/blog/images/Fi-1aE8NjmAZsqQF6Gi0OmOq9IKn.png">


<link rel="canonical" href="https://c4ooc0.github.io/2022/07/14/%E6%89%AB%E6%8F%8F%E6%8A%80%E6%9C%AF%E5%B0%8F%E8%AE%B0/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://c4ooc0.github.io/2022/07/14/%E6%89%AB%E6%8F%8F%E6%8A%80%E6%9C%AF%E5%B0%8F%E8%AE%B0/","path":"2022/07/14/扫描技术小记/","title":"扫描技术小记"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>扫描技术小记 | c4ooc0个人博客</title>
  






  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">c4ooc0个人博客</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">半吊子的安全工程师，ACG爱好者</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#c-%E6%AE%B5%E6%89%AB%E6%8F%8F"><span class="nav-number">1.</span> <span class="nav-text"> C 段扫描</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#ping"><span class="nav-number">1.1.</span> <span class="nav-text"> ping</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tcp-ack"><span class="nav-number">1.2.</span> <span class="nav-text"> tcp ack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#arp"><span class="nav-number">1.3.</span> <span class="nav-text"> arp</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%96%B9%E5%BC%8F"><span class="nav-number">1.4.</span> <span class="nav-text"> 其他方式</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AB%AF%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-number">2.</span> <span class="nav-text"> 端口扫描</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#tcp-syn-%E6%89%AB%E6%8F%8F%E5%8D%8A%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.1.</span> <span class="nav-text"> TCP SYN 扫描（半连接）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tcp-connect-%E6%89%AB%E6%8F%8F%E5%85%A8%E8%BF%9E%E6%8E%A5"><span class="nav-number">2.2.</span> <span class="nav-text"> TCP connect 扫描（全连接）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#idle"><span class="nav-number">2.3.</span> <span class="nav-text"> IDLE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%96%B9%E5%BC%8F-2"><span class="nav-number">2.4.</span> <span class="nav-text"> 其他方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#udp-%E6%89%AB%E6%8F%8F"><span class="nav-number">2.4.1.</span> <span class="nav-text"> UDP 扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tcp-nullfinand-xmas-%E6%89%AB%E6%8F%8F"><span class="nav-number">2.4.2.</span> <span class="nav-text"> TCP Null，FIN，and Xmas 扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tcp-ack-%E6%89%AB%E6%8F%8F"><span class="nav-number">2.4.3.</span> <span class="nav-text"> TCP ACK 扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tcp-%E7%AA%97%E5%8F%A3%E6%89%AB%E6%8F%8F"><span class="nav-number">2.4.4.</span> <span class="nav-text"> TCP 窗口扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#tcp-maimon-%E6%89%AB%E6%8F%8F"><span class="nav-number">2.4.5.</span> <span class="nav-text"> TCP Maimon 扫描</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ftp-%E5%BC%B9%E8%B7%B3%E6%89%AB%E6%8F%8F"><span class="nav-number">2.4.6.</span> <span class="nav-text"> FTP 弹跳扫描</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E8%AF%86%E5%88%AB"><span class="nav-number">3.</span> <span class="nav-text"> 服务识别</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E7%AB%AF%E5%8F%A3"><span class="nav-number">3.1.</span> <span class="nav-text"> 默认端口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#banner-%E4%BF%A1%E6%81%AF"><span class="nav-number">3.2.</span> <span class="nav-text"> banner 信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#payload"><span class="nav-number">3.3.</span> <span class="nav-text"> payload</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">c4ooc0</p>
  <div class="site-description" itemprop="description">永怀谦卑与求知欲</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/c4ooc0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;c4ooc0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.yuque.com/choocolate-yqwd/blog" title="语雀 → https:&#x2F;&#x2F;www.yuque.com&#x2F;choocolate-yqwd&#x2F;blog" rel="noopener" target="_blank">语雀</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      友友们
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://blog.c1ker.top/" title="https:&#x2F;&#x2F;blog.c1ker.top&#x2F;" rel="noopener" target="_blank">c1ker</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://c4ooc0.github.io/2022/07/14/%E6%89%AB%E6%8F%8F%E6%8A%80%E6%9C%AF%E5%B0%8F%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="c4ooc0">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="c4ooc0个人博客">
      <meta itemprop="description" content="永怀谦卑与求知欲">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="扫描技术小记 | c4ooc0个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          扫描技术小记
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-07-14 08:55:56" itemprop="dateCreated datePublished" datetime="2022-07-14T08:55:56+08:00">2022-07-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-11-10 16:45:47" itemprop="dateModified" datetime="2022-11-10T16:45:47+08:00">2022-11-10</time>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>文章大量内容参考了这本书：</p>
<p>内容不是很深，语言清晰易懂，看起来不太费劲，但颇有收获
还有 NMAP 参考指南：</p>
<p>对于 NMAP 的使用方法介绍了很多，但原理不是很清晰</p>
<hr />
<span id="more"></span>
<h1 id="c-段扫描"><a class="markdownIt-Anchor" href="#c-段扫描"></a> C 段扫描</h1>
<p>C 段指的是同一内网段内的其他服务器，每个 IP 有 ABCD 四个段，举个例子，192.168.0.1，A 段就是 192，B 段是 168，C 段是 0，D 段是 1，而 C 段嗅探的意思就是拿下它同一 C 段中的其中一台服务器，也就是说是 D 段 1-255 中的一台服务器，然后利用工具嗅探拿下该服务器。</p>
<h2 id="ping"><a class="markdownIt-Anchor" href="#ping"></a> ping</h2>
<p>1、主机可达
发送一个 type = 8,code = 0 的 ICMP Request 包，表示这是一个请求包，如果顺利的到达对应的主机，主机会发送一个 type = 0，code = 0 的 ICMP Reply 包。
如果发送方收到 Reply 包，就说明主机可达。</p>
<p>2、主机不可达
发送一个 type = 8,code = 0 的 ICMP Request 包，如果路由器中不存在到达目的 IP 的路由的时候，会返回一个 type = 3，code = 1 的 ICMP 包，表示主机不可达。
当发送方收到包后，发现 type = 3， code = 1，说明主机不可达</p>
<p>下面的是基于 bash 脚本，根据 ping 命令的输出来判断主机可不可达：
<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_43623271/article/details/122113368">参考博客：ping 命令脚本</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$1</span>&quot;</span> == <span class="string">&quot;&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">	<span class="built_in">echo</span> <span class="string">&quot;need an ip address&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">	<span class="keyword">for</span> ip <span class="keyword">in</span> `<span class="built_in">seq</span> 1 254`; <span class="keyword">do</span></span><br><span class="line">		ping -c 1 <span class="variable">$1</span>.<span class="variable">$ip</span> | grep <span class="string">&quot;64 bytes&quot;</span> | <span class="built_in">cut</span> -d <span class="string">&quot; &quot;</span> -f 4 | <span class="built_in">tr</span> -d <span class="string">&quot;:&quot;</span> &amp;</span><br><span class="line">	<span class="keyword">done</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>该脚本支持并行，速度很快
<strong>缺陷</strong>
如果目标主机禁用 icmp 回显请求，就该方法失效。可以使用其他方法探测，接下来介绍基于 tcp 的探测方法。</p>
<h2 id="tcp-ack"><a class="markdownIt-Anchor" href="#tcp-ack"></a> tcp ack</h2>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/gongheng1125/article/details/51219404">主机存活探测方式</a>
上面的博客介绍了很多探测方式，这里使用 ack 包进行测试</p>
<ul>
<li>若主机可达，则收到 RST 响应包。向目标主机发送 ACK 包，但目标主机并没有给本机发送 SYN 包表示要建立连接，而本机直接构造发送了 ACK 包表示同意连接，目标主机就会向我们回复 RST 数据包，表示不在线拒绝连接</li>
<li>若主机不可达，则不会收到响应包</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> optparse <span class="keyword">import</span> OptionParser</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">ip</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        dport = random.randint(<span class="number">1</span>, <span class="number">65535</span>)	<span class="comment">#随机目的端口</span></span><br><span class="line">        packet = IP(dst=ip)/TCP(flags=<span class="string">&quot;A&quot;</span>,dport=dport)	<span class="comment">#构造标志位为ACK的数据包</span></span><br><span class="line">        response = sr1(packet,timeout=<span class="number">0.5</span>, verbose=<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(response[TCP].flags) == <span class="number">4</span>:		<span class="comment">#判断响应包中是否存在RST标志位</span></span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] Host: %s on line&quot;</span> % ip)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line"></span><br><span class="line">    usage = <span class="string">&quot;Usage: %prog -f &lt;filename&gt; -i &lt;ip address&gt;&quot;</span>	<span class="comment"># 输出帮助信息</span></span><br><span class="line">    parse = OptionParser(usage=usage)</span><br><span class="line">    parse.add_option(<span class="string">&quot;-f&quot;</span>, <span class="string">&quot;--file&quot;</span>, <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span>, dest=<span class="string">&quot;filename&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;specify the IP address file&quot;</span>)	<span class="comment"># 获取ip地址问及</span></span><br><span class="line">    parse.add_option(<span class="string">&quot;-i&quot;</span>, <span class="string">&#x27;--ip&#x27;</span>, <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span>, dest=<span class="string">&quot;address&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;specify the IP address&quot;</span>)	<span class="comment"># 获取网段地址</span></span><br><span class="line">    option, args = parse.parse_args()	<span class="comment">#实例化用户输入的参数</span></span><br><span class="line">    filename = option.filename</span><br><span class="line">    address = option.address</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] The TCP ACK SCAN start&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> filename:	<span class="comment"># 判断用户输出的参数是否为读取ip地址文件，并判断文件是否存在</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filename):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;The file does not exist. Please enter it again&quot;</span>)</span><br><span class="line">            sys.exit()</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:	<span class="comment"># 读取文件</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> f.readlines():</span><br><span class="line">                ip = i.strip()			<span class="comment"># 调用多线程去发送数据包</span></span><br><span class="line">                t = Thread(target=scan, args=(ip,))</span><br><span class="line">                t.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> address:		<span class="comment">#判断用户输入的是为扫描网段</span></span><br><span class="line">        prefix = address.split(<span class="string">&quot;.&quot;</span>)[<span class="number">0</span>] + <span class="string">&#x27;.&#x27;</span> + address.split(<span class="string">&quot;.&quot;</span>)[<span class="number">1</span>] + <span class="string">&#x27;.&#x27;</span> + address.split(<span class="string">&quot;.&quot;</span>)[<span class="number">2</span>] + <span class="string">&quot;.&quot;</span>	<span class="comment"># 将用户输入的网段地址前三位以.作为分割提取出IP地址前缀</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">255</span>):</span><br><span class="line">            ip = prefix + <span class="built_in">str</span>(i)	<span class="comment"># 结合IP地址前缀构成ip</span></span><br><span class="line">            t = Thread(target=scan, args=(ip,))	<span class="comment"># 多线程发送数据包</span></span><br><span class="line">            t.start()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] The TCP ACK SCAN end&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p><strong>缺陷</strong>
很容易被基于状态的防火墙过滤，容易误判成非活跃主机。
<strong>改进</strong>
可以使用 TCP 协议的其他包，例如发 SYN 包，如果选择的端口是开放的，目标主机就会按照 TCP 三次握手的规定，发回一个 SYN/ACK 数据包，表示同意建立连接。如果这个端口关闭，目标主机就会拒绝这次连接，向本机发送一个 RST 数据包。不过这个阶段不在乎端口是否开放，只要收到响应数据包，就表示目标主机活跃。</p>
<h2 id="arp"><a class="markdownIt-Anchor" href="#arp"></a> arp</h2>
<p>当目标主机与本机处于同一网段的时候，使用 ARP 协议扫描技术就是最佳的选择。不仅速度最快，扫描结果也是最为精准的。这是因为没有任何安全措施会阻止正常的 ARP 请求。直接使用命令<code>arp -a</code>
<strong>缺陷</strong>
需要与目标主机处于同一网段，条件比较苛刻</p>
<h2 id="其他方式"><a class="markdownIt-Anchor" href="#其他方式"></a> 其他方式</h2>
<table>
<thead>
<tr>
<th>协议</th>
<th>方法</th>
<th>缺陷</th>
<th>改进</th>
</tr>
</thead>
<tbody>
<tr>
<td>UDP</td>
<td>当一个 UDP 端口收到一个 UDP 数据包时</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<ul>
<li>若关闭，就会给源端发回一个 ICMP 端口不可达数据包。</li>
<li>若开放，就会忽略这个数据包，也就是将它丢弃而不返回任何信息。
| 扫描结果的可靠性比较低、扫描速度慢
需避开常见端口 | 选择值比较大的端口 |
| SCTP | 四次握手：客户端使用一个 INIT 报文发起一个连接，服务器端使用一个 INIT-ACK 报文进行应答；客户端使用一个 INIT 报文发起一个连接，服务器端使用一个 INIT-ACK 报文进行应答。</li>
<li>若活跃，目标主机会使用 INIT-ACK 报文进行应答。</li>
<li>若不可达，则不返回任何信息。
| 支持这个协议的主机不多 | 使用其他协议：D |
| IP | 遍历 IP 协议号，用来确定目标机支持哪些 IP 协议
若收到任意响应，则该协议的对应 | 易被检测出发出的数据包内容为空 | 随机填充数据 |
| DNS | 使用 DNS 逆解析 | 耗时长
目标主机需要有域名 | |</li>
</ul>
<h1 id="端口扫描"><a class="markdownIt-Anchor" href="#端口扫描"></a> 端口扫描</h1>
<h2 id="tcp-syn-扫描半连接"><a class="markdownIt-Anchor" href="#tcp-syn-扫描半连接"></a> TCP SYN 扫描（半连接）</h2>
<p>本机向目标主机的一个端口发送请求连接的 SYN 数据包，而目标主机在接收到这个 SYN 数据包之后会根据不同情况做出不同应答：</p>
<table>
<thead>
<tr>
<th>应答</th>
<th>目标端口状态</th>
</tr>
</thead>
<tbody>
<tr>
<td>SYN/ACK</td>
<td>open</td>
</tr>
<tr>
<td>RST</td>
<td>closed</td>
</tr>
<tr>
<td>没有应答</td>
<td>过滤</td>
</tr>
<tr>
<td>icmp 差错报文</td>
<td>过滤</td>
</tr>
</tbody>
</table>
<p>目标主机以 SYN/ACK 进行应答，本机可以在收到 SYN/ACK 后会发送 RST 包请求断开连接而不是 ACK 应答。这样，三次握手就没有完成，无法建立正常的 TCP 连接，因此，这次扫描就不会被记录到系统日志中。这种扫描技术一般不会在目标主机上留下扫描痕迹。注意此方法 Linux 中通过 NMAP，需要 root 权限。
<strong>缺陷</strong>
容易被基于状态的防火墙拦住</p>
<h2 id="tcp-connect-扫描全连接"><a class="markdownIt-Anchor" href="#tcp-connect-扫描全连接"></a> TCP connect 扫描（全连接）</h2>
<p>这种扫描方式其实和 SYN 扫描很像，只是这种扫描方式完成了 TCP 的三次握手。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> optparse <span class="keyword">import</span> OptionParser</span><br><span class="line"></span><br><span class="line">lock = threading.Lock()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PortScanner</span>(<span class="params">host, port</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">        <span class="comment"># AF_INET 服务器之间网络通信</span></span><br><span class="line">        <span class="comment"># SOCK_STREAM 流式socket，for TCP</span></span><br><span class="line">        s.connect((host, port))</span><br><span class="line">        lock.acquire()</span><br><span class="line">        <span class="comment"># 只有一个线程能成功地获取锁</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[+] PORT: %d open&quot;</span> % port)</span><br><span class="line">        lock.release()</span><br><span class="line">        <span class="comment"># 释放锁</span></span><br><span class="line">        s.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生产按频率排序的端口列表</span></span><br><span class="line">top50_list = [<span class="number">21</span>,<span class="number">22</span>,<span class="number">25</span>,<span class="number">53</span>,<span class="number">80</span>,<span class="number">110</span>,<span class="number">113</span>,<span class="number">135</span>,<span class="number">139</span>,<span class="number">143</span>,<span class="number">179</span>,<span class="number">199</span>,<span class="number">443</span>,<span class="number">445</span>,<span class="number">465</span>,<span class="number">514</span>,<span class="number">548</span>,<span class="number">554</span>,<span class="number">587</span>,<span class="number">646</span>,<span class="number">993</span>,<span class="number">995</span>,<span class="number">1025</span>,<span class="number">1026</span>,<span class="number">1433</span>,<span class="number">1720</span>,<span class="number">1723</span>,<span class="number">2000</span>,<span class="number">3306</span>,<span class="number">3389</span>,<span class="number">5060</span>,<span class="number">5666</span>,<span class="number">5900</span>,<span class="number">6001</span>,<span class="number">8000</span>,<span class="number">8008</span>,<span class="number">8080</span>,<span class="number">8443</span>,<span class="number">8888</span>,<span class="number">10000</span>,<span class="number">32768</span>,<span class="number">49152</span>,<span class="number">49154</span>]</span><br><span class="line">top100_list = [<span class="number">7</span>,<span class="number">9</span>,<span class="number">13</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">25</span>,<span class="number">37</span>,<span class="number">53</span>,<span class="number">79</span>,<span class="number">80</span>,<span class="number">88</span>,<span class="number">106</span>,<span class="number">110</span>,<span class="number">113</span>,<span class="number">119</span>,<span class="number">135</span>,<span class="number">139</span>,<span class="number">143</span>,<span class="number">179</span>,<span class="number">199</span>,<span class="number">389</span>,<span class="number">427</span>,<span class="number">443</span>,<span class="number">444</span>,<span class="number">465</span>,<span class="number">513</span>,<span class="number">514</span>,<span class="number">543</span>,<span class="number">548</span>,<span class="number">554</span>,<span class="number">587</span>,<span class="number">631</span>,<span class="number">646</span>,<span class="number">873</span>,<span class="number">990</span>,<span class="number">993</span>,<span class="number">995</span>,<span class="number">1025</span>,<span class="number">1026</span>,<span class="number">1027</span>,<span class="number">1028</span>,<span class="number">1110</span>,<span class="number">1433</span>,<span class="number">1720</span>,<span class="number">1723</span>,<span class="number">1755</span>,<span class="number">1900</span>,<span class="number">2000</span>,<span class="number">2049</span>,<span class="number">2121</span>,<span class="number">2717</span>,<span class="number">3000</span>,<span class="number">3128</span>,<span class="number">3306</span>,<span class="number">3389</span>,<span class="number">3986</span>,<span class="number">4899</span>,<span class="number">5000</span>,<span class="number">5009</span>,<span class="number">5051</span>,<span class="number">5060</span>,<span class="number">5101</span>,<span class="number">5190</span>,<span class="number">5357</span>,<span class="number">5432</span>,<span class="number">5631</span>,<span class="number">5666</span>,<span class="number">5800</span>,<span class="number">5900</span>,<span class="number">6000</span>,<span class="number">6646</span>,<span class="number">7070</span>,<span class="number">8000</span>,<span class="number">8008</span>,<span class="number">8080</span>,<span class="number">8443</span>,<span class="number">8888</span>,<span class="number">9100</span>,<span class="number">9999</span>,<span class="number">32768</span>,<span class="number">49152</span>,<span class="number">49153</span>,<span class="number">49154</span>,<span class="number">49155</span>,<span class="number">49156</span>]</span><br><span class="line">top1000_list = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">13</span>,<span class="number">17</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span>,<span class="number">23</span>,<span class="number">24</span>,<span class="number">25</span>,<span class="number">30</span>,<span class="number">32</span>,<span class="number">37</span>,<span class="number">42</span>,<span class="number">49</span>,<span class="number">53</span>,<span class="number">70</span>,<span class="number">79</span>,<span class="number">80</span>,<span class="number">81</span>,<span class="number">82</span>,<span class="number">83</span>,<span class="number">84</span>,<span class="number">88</span>,<span class="number">89</span>,<span class="number">99</span>,<span class="number">106</span>,<span class="number">109</span>,<span class="number">110</span>,<span class="number">113</span>,<span class="number">119</span>,<span class="number">125</span>,<span class="number">135</span>,<span class="number">139</span>,<span class="number">143</span>,<span class="number">146</span>,<span class="number">161</span>,<span class="number">163</span>,<span class="number">179</span>,<span class="number">199</span>,<span class="number">211</span>,<span class="number">222</span>,<span class="number">254</span>,<span class="number">255</span>,<span class="number">259</span>,<span class="number">264</span>,<span class="number">280</span>,<span class="number">301</span>,<span class="number">306</span>,<span class="number">311</span>,<span class="number">340</span>,<span class="number">366</span>,<span class="number">389</span>,<span class="number">406</span>,<span class="number">416</span>,<span class="number">425</span>,<span class="number">427</span>,<span class="number">443</span>,<span class="number">444</span>,<span class="number">458</span>,<span class="number">464</span>,<span class="number">481</span>,<span class="number">497</span>,<span class="number">500</span>,<span class="number">512</span>,<span class="number">513</span>,<span class="number">514</span>,<span class="number">524</span>,<span class="number">541</span>,<span class="number">543</span>,<span class="number">544</span>,<span class="number">548</span>,<span class="number">554</span>,<span class="number">563</span>,<span class="number">587</span>,<span class="number">593</span>,<span class="number">616</span>,<span class="number">625</span>,<span class="number">631</span>,<span class="number">636</span>,<span class="number">646</span>,<span class="number">648</span>,<span class="number">666</span>,<span class="number">667</span>,<span class="number">683</span>,<span class="number">687</span>,<span class="number">691</span>,<span class="number">700</span>,<span class="number">705</span>,<span class="number">711</span>,<span class="number">714</span>,<span class="number">720</span>,<span class="number">722</span>,<span class="number">726</span>,<span class="number">749</span>,<span class="number">765</span>,<span class="number">777</span>,<span class="number">783</span>,<span class="number">787</span>,<span class="number">800</span>,<span class="number">808</span>,<span class="number">843</span>,<span class="number">873</span>,<span class="number">880</span>,<span class="number">888</span>,<span class="number">898</span>,<span class="number">900</span>,<span class="number">901</span>,<span class="number">902</span>,<span class="number">911</span>,<span class="number">981</span>,<span class="number">987</span>,<span class="number">990</span>,<span class="number">992</span>,<span class="number">995</span>,<span class="number">999</span>,<span class="number">1000</span>,<span class="number">1001</span>,<span class="number">1007</span>,<span class="number">1009</span>,<span class="number">1010</span>,<span class="number">1021</span>,<span class="number">1022</span>,<span class="number">1023</span>,<span class="number">1024</span>,<span class="number">1025</span>,<span class="number">1026</span>,<span class="number">1027</span>,<span class="number">1028</span>,<span class="number">1029</span>,<span class="number">1030</span>,<span class="number">1031</span>,<span class="number">1032</span>,<span class="number">1033</span>,<span class="number">1034</span>,<span class="number">1035</span>,<span class="number">1036</span>,<span class="number">1037</span>,<span class="number">1038</span>,<span class="number">1039</span>,<span class="number">1040</span>,<span class="number">1041</span>,<span class="number">1042</span>,<span class="number">1043</span>,<span class="number">1044</span>,<span class="number">1045</span>,<span class="number">1046</span>,<span class="number">1047</span>,<span class="number">1048</span>,<span class="number">1049</span>,<span class="number">1050</span>,<span class="number">1051</span>,<span class="number">1052</span>,<span class="number">1053</span>,<span class="number">1054</span>,<span class="number">1055</span>,<span class="number">1056</span>,<span class="number">1057</span>,<span class="number">1058</span>,<span class="number">1059</span>,<span class="number">1060</span>,<span class="number">1061</span>,<span class="number">1062</span>,<span class="number">1063</span>,<span class="number">1064</span>,<span class="number">1065</span>,<span class="number">1066</span>,<span class="number">1067</span>,<span class="number">1068</span>,<span class="number">1069</span>,<span class="number">1070</span>,<span class="number">1071</span>,<span class="number">1072</span>,<span class="number">1073</span>,<span class="number">1074</span>,<span class="number">1075</span>,<span class="number">1076</span>,<span class="number">1077</span>,<span class="number">1078</span>,<span class="number">1079</span>,<span class="number">1080</span>,<span class="number">1081</span>,<span class="number">1082</span>,<span class="number">1083</span>,<span class="number">1084</span>,<span class="number">1085</span>,<span class="number">1086</span>,<span class="number">1087</span>,<span class="number">1088</span>,<span class="number">1089</span>,<span class="number">1090</span>,<span class="number">1091</span>,<span class="number">1092</span>,<span class="number">1093</span>,<span class="number">1094</span>,<span class="number">1095</span>,<span class="number">1096</span>,<span class="number">1097</span>,<span class="number">1098</span>,<span class="number">1099</span>,<span class="number">1102</span>,<span class="number">1104</span>,<span class="number">1105</span>,<span class="number">1106</span>,<span class="number">1107</span>,<span class="number">1110</span>,<span class="number">1111</span>,<span class="number">1112</span>,<span class="number">1113</span>,<span class="number">1117</span>,<span class="number">1119</span>,<span class="number">1121</span>,<span class="number">1122</span>,<span class="number">1123</span>,<span class="number">1126</span>,<span class="number">1130</span>,<span class="number">1131</span>,<span class="number">1137</span>,<span class="number">1141</span>,<span class="number">1145</span>,<span class="number">1147</span>,<span class="number">1148</span>,<span class="number">1151</span>,<span class="number">1154</span>,<span class="number">1163</span>,<span class="number">1164</span>,<span class="number">1165</span>,<span class="number">1169</span>,<span class="number">1174</span>,<span class="number">1183</span>,<span class="number">1185</span>,<span class="number">1186</span>,<span class="number">1192</span>,<span class="number">1198</span>,<span class="number">1201</span>,<span class="number">1213</span>,<span class="number">1216</span>,<span class="number">1217</span>,<span class="number">1233</span>,<span class="number">1236</span>,<span class="number">1244</span>,<span class="number">1247</span>,<span class="number">1259</span>,<span class="number">1271</span>,<span class="number">1277</span>,<span class="number">1287</span>,<span class="number">1296</span>,<span class="number">1300</span>,<span class="number">1309</span>,<span class="number">1310</span>,<span class="number">1322</span>,<span class="number">1328</span>,<span class="number">1334</span>,<span class="number">1352</span>,<span class="number">1417</span>,<span class="number">1433</span>,<span class="number">1443</span>,<span class="number">1455</span>,<span class="number">1461</span>,<span class="number">1494</span>,<span class="number">1500</span>,<span class="number">1503</span>,<span class="number">1521</span>,<span class="number">1524</span>,<span class="number">1533</span>,<span class="number">1556</span>,<span class="number">1580</span>,<span class="number">1583</span>,<span class="number">1594</span>,<span class="number">1600</span>,<span class="number">1641</span>,<span class="number">1658</span>,<span class="number">1666</span>,<span class="number">1687</span>,<span class="number">1700</span>,<span class="number">1717</span>,<span class="number">1718</span>,<span class="number">1719</span>,<span class="number">1720</span>,<span class="number">1723</span>,<span class="number">1755</span>,<span class="number">1761</span>,<span class="number">1782</span>,<span class="number">1801</span>,<span class="number">1805</span>,<span class="number">1812</span>,<span class="number">1839</span>,<span class="number">1862</span>,<span class="number">1863</span>,<span class="number">1875</span>,<span class="number">1900</span>,<span class="number">1914</span>,<span class="number">1935</span>,<span class="number">1947</span>,<span class="number">1971</span>,<span class="number">1974</span>,<span class="number">1984</span>,<span class="number">1998</span>,<span class="number">1999</span>,<span class="number">2000</span>,<span class="number">2001</span>,<span class="number">2002</span>,<span class="number">2003</span>,<span class="number">2004</span>,<span class="number">2005</span>,<span class="number">2006</span>,<span class="number">2007</span>,<span class="number">2008</span>,<span class="number">2009</span>,<span class="number">2013</span>,<span class="number">2020</span>,<span class="number">2021</span>,<span class="number">2030</span>,<span class="number">2033</span>,<span class="number">2034</span>,<span class="number">2038</span>,<span class="number">2040</span>,<span class="number">2041</span>,<span class="number">2042</span>,<span class="number">2045</span>,<span class="number">2046</span>,<span class="number">2047</span>,<span class="number">2048</span>,<span class="number">2065</span>,<span class="number">2068</span>,<span class="number">2099</span>,<span class="number">2103</span>,<span class="number">2105</span>,<span class="number">2106</span>,<span class="number">2111</span>,<span class="number">2119</span>,<span class="number">2121</span>,<span class="number">2126</span>,<span class="number">2135</span>,<span class="number">2144</span>,<span class="number">2160</span>,<span class="number">2170</span>,<span class="number">2179</span>,<span class="number">2190</span>,<span class="number">2196</span>,<span class="number">2200</span>,<span class="number">2222</span>,<span class="number">2251</span>,<span class="number">2260</span>,<span class="number">2288</span>,<span class="number">2301</span>,<span class="number">2323</span>,<span class="number">2366</span>,<span class="number">2381</span>,<span class="number">2382</span>,<span class="number">2393</span>,<span class="number">2399</span>,<span class="number">2401</span>,<span class="number">2492</span>,<span class="number">2500</span>,<span class="number">2522</span>,<span class="number">2525</span>,<span class="number">2557</span>,<span class="number">2601</span>,<span class="number">2604</span>,<span class="number">2607</span>,<span class="number">2638</span>,<span class="number">2701</span>,<span class="number">2710</span>,<span class="number">2717</span>,<span class="number">2725</span>,<span class="number">2800</span>,<span class="number">2809</span>,<span class="number">2811</span>,<span class="number">2869</span>,<span class="number">2875</span>,<span class="number">2909</span>,<span class="number">2920</span>,<span class="number">2967</span>,<span class="number">2998</span>,<span class="number">3000</span>,<span class="number">3003</span>,<span class="number">3005</span>,<span class="number">3006</span>,<span class="number">3011</span>,<span class="number">3013</span>,<span class="number">3017</span>,<span class="number">3030</span>,<span class="number">3052</span>,<span class="number">3071</span>,<span class="number">3077</span>,<span class="number">3128</span>,<span class="number">3168</span>,<span class="number">3211</span>,<span class="number">3221</span>,<span class="number">3260</span>,<span class="number">3268</span>,<span class="number">3283</span>,<span class="number">3300</span>,<span class="number">3306</span>,<span class="number">3322</span>,<span class="number">3323</span>,<span class="number">3324</span>,<span class="number">3333</span>,<span class="number">3351</span>,<span class="number">3367</span>,<span class="number">3369</span>,<span class="number">3370</span>,<span class="number">3371</span>,<span class="number">3389</span>,<span class="number">3404</span>,<span class="number">3476</span>,<span class="number">3493</span>,<span class="number">3517</span>,<span class="number">3527</span>,<span class="number">3546</span>,<span class="number">3551</span>,<span class="number">3580</span>,<span class="number">3659</span>,<span class="number">3689</span>,<span class="number">3703</span>,<span class="number">3737</span>,<span class="number">3766</span>,<span class="number">3784</span>,<span class="number">3800</span>,<span class="number">3809</span>,<span class="number">3814</span>,<span class="number">3826</span>,<span class="number">3827</span>,<span class="number">3851</span>,<span class="number">3869</span>,<span class="number">3871</span>,<span class="number">3878</span>,<span class="number">3880</span>,<span class="number">3889</span>,<span class="number">3905</span>,<span class="number">3914</span>,<span class="number">3918</span>,<span class="number">3920</span>,<span class="number">3945</span>,<span class="number">3971</span>,<span class="number">3986</span>,<span class="number">3995</span>,<span class="number">3998</span>,<span class="number">4000</span>,<span class="number">4001</span>,<span class="number">4002</span>,<span class="number">4003</span>,<span class="number">4004</span>,<span class="number">4005</span>,<span class="number">4045</span>,<span class="number">4111</span>,<span class="number">4125</span>,<span class="number">4129</span>,<span class="number">4224</span>,<span class="number">4242</span>,<span class="number">4279</span>,<span class="number">4321</span>,<span class="number">4343</span>,<span class="number">4443</span>,<span class="number">4444</span>,<span class="number">4445</span>,<span class="number">4449</span>,<span class="number">4550</span>,<span class="number">4567</span>,<span class="number">4662</span>,<span class="number">4848</span>,<span class="number">4899</span>,<span class="number">4998</span>,<span class="number">5000</span>,<span class="number">5001</span>,<span class="number">5002</span>,<span class="number">5003</span>,<span class="number">5009</span>,<span class="number">5030</span>,<span class="number">5033</span>,<span class="number">5050</span>,<span class="number">5054</span>,<span class="number">5060</span>,<span class="number">5080</span>,<span class="number">5087</span>,<span class="number">5100</span>,<span class="number">5101</span>,<span class="number">5120</span>,<span class="number">5190</span>,<span class="number">5200</span>,<span class="number">5214</span>,<span class="number">5221</span>,<span class="number">5225</span>,<span class="number">5269</span>,<span class="number">5280</span>,<span class="number">5298</span>,<span class="number">5357</span>,<span class="number">5405</span>,<span class="number">5414</span>,<span class="number">5431</span>,<span class="number">5440</span>,<span class="number">5500</span>,<span class="number">5510</span>,<span class="number">5544</span>,<span class="number">5550</span>,<span class="number">5555</span>,<span class="number">5560</span>,<span class="number">5566</span>,<span class="number">5631</span>,<span class="number">5633</span>,<span class="number">5666</span>,<span class="number">5678</span>,<span class="number">5718</span>,<span class="number">5730</span>,<span class="number">5800</span>,<span class="number">5801</span>,<span class="number">5810</span>,<span class="number">5815</span>,<span class="number">5822</span>,<span class="number">5825</span>,<span class="number">5850</span>,<span class="number">5859</span>,<span class="number">5862</span>,<span class="number">5877</span>,<span class="number">5900</span>,<span class="number">5901</span>,<span class="number">5902</span>,<span class="number">5903</span>,<span class="number">5906</span>,<span class="number">5910</span>,<span class="number">5915</span>,<span class="number">5922</span>,<span class="number">5925</span>,<span class="number">5950</span>,<span class="number">5952</span>,<span class="number">5959</span>,<span class="number">5960</span>,<span class="number">5961</span>,<span class="number">5962</span>,<span class="number">5987</span>,<span class="number">5988</span>,<span class="number">5998</span>,<span class="number">5999</span>,<span class="number">6000</span>,<span class="number">6001</span>,<span class="number">6002</span>,<span class="number">6003</span>,<span class="number">6004</span>,<span class="number">6005</span>,<span class="number">6006</span>,<span class="number">6009</span>,<span class="number">6025</span>,<span class="number">6059</span>,<span class="number">6100</span>,<span class="number">6106</span>,<span class="number">6112</span>,<span class="number">6123</span>,<span class="number">6129</span>,<span class="number">6156</span>,<span class="number">6346</span>,<span class="number">6389</span>,<span class="number">6502</span>,<span class="number">6510</span>,<span class="number">6543</span>,<span class="number">6547</span>,<span class="number">6565</span>,<span class="number">6566</span>,<span class="number">6580</span>,<span class="number">6646</span>,<span class="number">6666</span>,<span class="number">6667</span>,<span class="number">6668</span>,<span class="number">6689</span>,<span class="number">6692</span>,<span class="number">6699</span>,<span class="number">6779</span>,<span class="number">6788</span>,<span class="number">6792</span>,<span class="number">6839</span>,<span class="number">6881</span>,<span class="number">6901</span>,<span class="number">6969</span>,<span class="number">7000</span>,<span class="number">7001</span>,<span class="number">7004</span>,<span class="number">7007</span>,<span class="number">7019</span>,<span class="number">7025</span>,<span class="number">7070</span>,<span class="number">7100</span>,<span class="number">7103</span>,<span class="number">7106</span>,<span class="number">7200</span>,<span class="number">7402</span>,<span class="number">7435</span>,<span class="number">7443</span>,<span class="number">7496</span>,<span class="number">7512</span>,<span class="number">7625</span>,<span class="number">7627</span>,<span class="number">7676</span>,<span class="number">7741</span>,<span class="number">7777</span>,<span class="number">7800</span>,<span class="number">7911</span>,<span class="number">7920</span>,<span class="number">7937</span>,<span class="number">7999</span>,<span class="number">8000</span>,<span class="number">8001</span>,<span class="number">8007</span>,<span class="number">8008</span>,<span class="number">8009</span>,<span class="number">8010</span>,<span class="number">8021</span>,<span class="number">8031</span>,<span class="number">8042</span>,<span class="number">8045</span>,<span class="number">8080</span>,<span class="number">8081</span>,<span class="number">8082</span>,<span class="number">8083</span>,<span class="number">8084</span>,<span class="number">8085</span>,<span class="number">8086</span>,<span class="number">8087</span>,<span class="number">8088</span>,<span class="number">8089</span>,<span class="number">8093</span>,<span class="number">8099</span>,<span class="number">8180</span>,<span class="number">8192</span>,<span class="number">8193</span>,<span class="number">8200</span>,<span class="number">8222</span>,<span class="number">8254</span>,<span class="number">8290</span>,<span class="number">8291</span>,<span class="number">8300</span>,<span class="number">8333</span>,<span class="number">8383</span>,<span class="number">8400</span>,<span class="number">8402</span>,<span class="number">8443</span>,<span class="number">8500</span>,<span class="number">8600</span>,<span class="number">8649</span>,<span class="number">8651</span>,<span class="number">8654</span>,<span class="number">8701</span>,<span class="number">8800</span>,<span class="number">8873</span>,<span class="number">8888</span>,<span class="number">8899</span>,<span class="number">8994</span>,<span class="number">9000</span>,<span class="number">9001</span>,<span class="number">9002</span>,<span class="number">9009</span>,<span class="number">9010</span>,<span class="number">9040</span>,<span class="number">9050</span>,<span class="number">9071</span>,<span class="number">9080</span>,<span class="number">9090</span>,<span class="number">9099</span>,<span class="number">9100</span>,<span class="number">9101</span>,<span class="number">9102</span>,<span class="number">9110</span>,<span class="number">9200</span>,<span class="number">9207</span>,<span class="number">9220</span>,<span class="number">9290</span>,<span class="number">9415</span>,<span class="number">9418</span>,<span class="number">9485</span>,<span class="number">9500</span>,<span class="number">9502</span>,<span class="number">9535</span>,<span class="number">9575</span>,<span class="number">9593</span>,<span class="number">9594</span>,<span class="number">9618</span>,<span class="number">9666</span>,<span class="number">9876</span>,<span class="number">9877</span>,<span class="number">9898</span>,<span class="number">9900</span>,<span class="number">9917</span>,<span class="number">9929</span>,<span class="number">9943</span>,<span class="number">9968</span>,<span class="number">9998</span>,<span class="number">9999</span>,<span class="number">10000</span>,<span class="number">10001</span>,<span class="number">10002</span>,<span class="number">10003</span>,<span class="number">10009</span>,<span class="number">10012</span>,<span class="number">10024</span>,<span class="number">10082</span>,<span class="number">10180</span>,<span class="number">10215</span>,<span class="number">10243</span>,<span class="number">10566</span>,<span class="number">10616</span>,<span class="number">10621</span>,<span class="number">10626</span>,<span class="number">10628</span>,<span class="number">10778</span>,<span class="number">11110</span>,<span class="number">11967</span>,<span class="number">12000</span>,<span class="number">12174</span>,<span class="number">12265</span>,<span class="number">12345</span>,<span class="number">13456</span>,<span class="number">13722</span>,<span class="number">13782</span>,<span class="number">14000</span>,<span class="number">14238</span>,<span class="number">14441</span>,<span class="number">15000</span>,<span class="number">15002</span>,<span class="number">15003</span>,<span class="number">15660</span>,<span class="number">15742</span>,<span class="number">16000</span>,<span class="number">16012</span>,<span class="number">16016</span>,<span class="number">16018</span>,<span class="number">16080</span>,<span class="number">16113</span>,<span class="number">16992</span>,<span class="number">17877</span>,<span class="number">17988</span>,<span class="number">18040</span>,<span class="number">18101</span>,<span class="number">18988</span>,<span class="number">19101</span>,<span class="number">19283</span>,<span class="number">19315</span>,<span class="number">19350</span>,<span class="number">19780</span>,<span class="number">19801</span>,<span class="number">19842</span>,<span class="number">20000</span>,<span class="number">20005</span>,<span class="number">20031</span>,<span class="number">20221</span>,<span class="number">20828</span>,<span class="number">21571</span>,<span class="number">22939</span>,<span class="number">23502</span>,<span class="number">24444</span>,<span class="number">24800</span>,<span class="number">25734</span>,<span class="number">26214</span>,<span class="number">27000</span>,<span class="number">27352</span>,<span class="number">27355</span>,<span class="number">27715</span>,<span class="number">28201</span>,<span class="number">30000</span>,<span class="number">30718</span>,<span class="number">30951</span>,<span class="number">31038</span>,<span class="number">31337</span>,<span class="number">32768</span>,<span class="number">32769</span>,<span class="number">32770</span>,<span class="number">32771</span>,<span class="number">32772</span>,<span class="number">32773</span>,<span class="number">32774</span>,<span class="number">32775</span>,<span class="number">32776</span>,<span class="number">32777</span>,<span class="number">32778</span>,<span class="number">32779</span>,<span class="number">32780</span>,<span class="number">32781</span>,<span class="number">32782</span>,<span class="number">32783</span>,<span class="number">32784</span>,<span class="number">33354</span>,<span class="number">33899</span>,<span class="number">34571</span>,<span class="number">34572</span>,<span class="number">35500</span>,<span class="number">38292</span>,<span class="number">40193</span>,<span class="number">40911</span>,<span class="number">41511</span>,<span class="number">42510</span>,<span class="number">44176</span>,<span class="number">44442</span>,<span class="number">44501</span>,<span class="number">45100</span>,<span class="number">48080</span>,<span class="number">49152</span>,<span class="number">49153</span>,<span class="number">49154</span>,<span class="number">49155</span>,<span class="number">49156</span>,<span class="number">49157</span>,<span class="number">49158</span>,<span class="number">49159</span>,<span class="number">49160</span>,<span class="number">49163</span>,<span class="number">49165</span>,<span class="number">49167</span>,<span class="number">49175</span>,<span class="number">49400</span>,<span class="number">49999</span>,<span class="number">50000</span>,<span class="number">50001</span>,<span class="number">50002</span>,<span class="number">50006</span>,<span class="number">50300</span>,<span class="number">50389</span>,<span class="number">50500</span>,<span class="number">50636</span>,<span class="number">50800</span>,<span class="number">51103</span>,<span class="number">51493</span>,<span class="number">52673</span>,<span class="number">52822</span>,<span class="number">52848</span>,<span class="number">52869</span>,<span class="number">54045</span>,<span class="number">54328</span>,<span class="number">55055</span>,<span class="number">55555</span>,<span class="number">55600</span>,<span class="number">56737</span>,<span class="number">57294</span>,<span class="number">57797</span>,<span class="number">58080</span>,<span class="number">60020</span>,<span class="number">60443</span>,<span class="number">61532</span>,<span class="number">61900</span>,<span class="number">62078</span>,<span class="number">63331</span>,<span class="number">64623</span>,<span class="number">64680</span>,<span class="number">65000</span>,<span class="number">65129</span>,<span class="number">65389</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">defualt_port=top50_list+top100_list+top1000_list</span><br><span class="line">port_set=<span class="built_in">set</span>(defualt_port)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">65535</span>):</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> port_set:</span><br><span class="line">        defualt_port.append(i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    usage = <span class="string">&quot;Usage: %prog -i &lt;ip address&gt; -p &lt;dst port&gt;&quot;</span>	<span class="comment"># 输出帮助信息</span></span><br><span class="line">    parse = OptionParser(usage=usage)</span><br><span class="line">    parse.add_option(<span class="string">&quot;-i&quot;</span>, <span class="string">&#x27;--ip&#x27;</span>, <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span>, dest=<span class="string">&quot;address&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;specify the IP address&quot;</span>)	<span class="comment"># 获取网段地址</span></span><br><span class="line">    parse.add_option(<span class="string">&quot;-p&quot;</span>, <span class="string">&#x27;--port&#x27;</span>, <span class="built_in">type</span>=<span class="string">&quot;string&quot;</span>, dest=<span class="string">&quot;port&quot;</span>, <span class="built_in">help</span>=<span class="string">&quot;target port range,default option d&quot;</span>)</span><br><span class="line">    option, args = parse.parse_args()	<span class="comment">#实例化用户输入的参数</span></span><br><span class="line">    IP = option.address</span><br><span class="line">    PORT = option.port</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] The TCP Connect Port Scan start&#x27;</span>)</span><br><span class="line">    <span class="comment"># PORT = input(&quot;Please Input PORT（Separated by &#x27;,&#x27;）:&gt;&quot;)</span></span><br><span class="line">    <span class="keyword">if</span> PORT==<span class="string">&quot;d&quot;</span>:</span><br><span class="line">        portList=defualt_port</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        portList = PORT.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> portList:</span><br><span class="line">        <span class="keyword">if</span> i.isdigit():</span><br><span class="line">            t = threading.Thread(target=PortScanner, args=(IP, <span class="built_in">int</span>(i)))</span><br><span class="line">            <span class="comment"># args 动态参数就是传入的参数的个数是动态的</span></span><br><span class="line">            t.start()</span><br><span class="line">            t.join()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            newPortList = i.split(<span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">            startPort = <span class="built_in">int</span>(newPortList[<span class="number">0</span>])</span><br><span class="line">            endPort = <span class="built_in">int</span>(newPortList[<span class="number">0</span>])</span><br><span class="line">            <span class="keyword">for</span> port <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(newPortList[<span class="number">0</span>]), <span class="built_in">int</span>(newPortList[<span class="number">0</span>])):</span><br><span class="line">                t = threading.Thread(target=PortScanner, args=(IP, port))</span><br><span class="line">                t.start()</span><br><span class="line">                t.join()</span><br><span class="line">    setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] The TCP CONNECT SCAN is complete!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>缺陷</strong>
容易被发现</p>
<h2 id="idle"><a class="markdownIt-Anchor" href="#idle"></a> IDLE</h2>
<p>不太常见，也不好用，但比较巧妙，记录下来。
步骤 1：检测第三方的 IP ID 值并记录下来。
步骤 2：在本机上伪造一个源地址为第三方主机的数据包，并将数据包发送给目标主机端口，根据目标端口状态的不同，目标主机可能会导致第三方主机的 IP ID 值增加。
步骤 3：再回来检查第三方主机的 IP ID 值。比较这两次的值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> optparse <span class="keyword">import</span> OptionParser</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> scapy.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> scapy.layers.inet <span class="keyword">import</span> IP, TCP</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">scan</span>(<span class="params">ip, port</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 步骤1：检测第三方的IP ID值并记录下来。</span></span><br><span class="line">        third_party_ip = <span class="string">&quot;192.168.42.128&quot;</span></span><br><span class="line">        packet = IP(dst=third_party_ip)</span><br><span class="line">        response = sr1(packet, timeout=<span class="number">0.5</span>, verbose=<span class="number">0</span>)</span><br><span class="line">        pre_id = response[IP].<span class="built_in">id</span></span><br><span class="line">        <span class="comment"># 步骤2：在本机上伪造一个源地址为第三方主机的数据包，并将数据包发送给目标主机端口</span></span><br><span class="line">        packet2 = IP(src=third_party_ip, dst=ip) / TCP(flags=<span class="string">&quot;S&quot;</span>, dport=port)</span><br><span class="line">        send(packet2, verbose=<span class="number">0</span>)</span><br><span class="line">        time.sleep(<span class="number">0.05</span>)</span><br><span class="line">        <span class="comment"># 步骤3：再回来检查第三方主机的IP ID值。</span></span><br><span class="line">        packet3 = IP(dst=third_party_ip)</span><br><span class="line">        response3 = sr1(packet3, timeout=<span class="number">0.5</span>, verbose=<span class="number">0</span>)</span><br><span class="line">        next_id = response3[IP].<span class="built_in">id</span></span><br><span class="line">        <span class="keyword">if</span> next_id == (pre_id + <span class="number">1</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;[+] PORT &quot;</span> + port + <span class="string">&quot; maybe open&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] Scan start&#x27;</span>)</span><br><span class="line">    IP = <span class="string">&quot;192.168.42.129&quot;</span></span><br><span class="line">    <span class="comment"># PORT = input(&quot;Please Input PORT（Separated by &#x27;,&#x27;）:&gt;&quot;)</span></span><br><span class="line">    portList = [<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">3307</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> portList:</span><br><span class="line">        scan(IP, i)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] Scan complete!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p><strong>缺陷</strong>
不能并行，扫描时间较长，需第三方网络不太活跃的主机，扫描结果不一定准确
这种方法网上没人写是有原因的，成功率不高。暂时想不到改进措施。</p>
<h2 id="其他方式-2"><a class="markdownIt-Anchor" href="#其他方式-2"></a> 其他方式</h2>
<p>这篇文章基本就是 NMAP 里提到的技术，配了点插图，更好理解。</p>
<h3 id="udp-扫描"><a class="markdownIt-Anchor" href="#udp-扫描"></a> UDP 扫描</h3>
<p>与 C 段扫描中说到的方法一模一样，这里提一下。UDP 扫描发送空的(没有数据)UDP 报头到每个目标端口。 如果返回 ICMP 端口不可到达错误(类型 3，代码 3)， 该端口是 closed(关闭的)。 其它 ICMP 不可到达错误(类型 3， 代码 1，2，9，10，或者 13)表明该端口是 filtered(被过滤的)。 偶尔地，某服务会响应一个 UDP 报文，证明该端口是 open(开放的)。 如果几次重试后还没有响应，该端口就被认为是 open|filtered(开放|被过滤的)。 这意味着该端口可能是开放的，也可能包过滤器正在封锁通信。</p>
<p>| ICMP 端口不可到达错误(类型 3，代码 3)                 | closed   |
| ----------------------------------------------------- | -------- | -------- |
| ICMP 不可到达错误(类型 3， 代码 1，2，9，10，或者 13) | filtered |
| 响应                                                  | open     |
| 重试未响应                                            | open     | filtered |</p>
<h3 id="tcp-nullfinand-xmas-扫描"><a class="markdownIt-Anchor" href="#tcp-nullfinand-xmas-扫描"></a> TCP Null，FIN，and Xmas 扫描</h3>
<p>如果 [目标]端口状态是关闭的.... 进入的不含 RST 的报文导致一个 RST 响应 如果扫描系统遵循该 RFC，当端口关闭时，任何不包含 SYN，RST，或者 ACK 位的报文会导致 一个 RST 返回；而当端口开放时，应该没有任何响应。
如果收到一个 RST 报文，该端口被认为是 closed，而没有响应则意味着 端口 open|filtered。 如果收到 ICMP 不可到达错误(类型 3，代号 1，2，3，9，10，或者 13)，该端口 filtered。可以通过一些无状态防火墙和报文过滤路由器 ，比 SYN 扫描还要隐秘一些</p>
<h3 id="tcp-ack-扫描"><a class="markdownIt-Anchor" href="#tcp-ack-扫描"></a> TCP ACK 扫描</h3>
<p>这种扫描技术无法确定端口的开放性，因为它做的就是发送一个 ACK 报文，但服务端在收到该报文时，无论端口是否开放(open/closed)，只要未被过滤，都会返回一个 RST 报文，将它们认为是 unfiltered，而当扫描一个端口未得到响应时则认为是 filtered，同样的 ICMP 不可达也认为是 filtered。</p>
<table>
<thead>
<tr>
<th>行为</th>
<th>状态</th>
</tr>
</thead>
<tbody>
<tr>
<td>收到 RST 报文</td>
<td>unfiltered(open/closed)</td>
</tr>
<tr>
<td>未响应</td>
<td>filtered</td>
</tr>
<tr>
<td>ICMP 不可达</td>
<td>filtered</td>
</tr>
</tbody>
</table>
<h3 id="tcp-窗口扫描"><a class="markdownIt-Anchor" href="#tcp-窗口扫描"></a> TCP 窗口扫描</h3>
<p>发送一个 ACK 报文，到目标关闭的端口，会发现 window 的字段为 0。可以根据 window 值是正值 or 0 来判断目标端口是 open 还是 closed。
现在大多数情况都不管用了。</p>
<h3 id="tcp-maimon-扫描"><a class="markdownIt-Anchor" href="#tcp-maimon-扫描"></a> TCP Maimon 扫描</h3>
<p>这个名称是用此项扫描提出者 Uriel Maimon 的名字命名的。这项技术和 Null，FIN，以及 Xmas 扫描是一样的，但是要注意它的探测报文使用的是 FIN/ACK。根据 RFC 793 (TCP)，无论端口开放或者关闭，都应该对这样的探测响应 RST 报文。 然而，Uriel 注意到如果端口开放，许多基于 BSD 的系统只是丢弃该探测报文。</p>
<h3 id="ftp-弹跳扫描"><a class="markdownIt-Anchor" href="#ftp-弹跳扫描"></a> FTP 弹跳扫描</h3>
<p>允许用户连接到一台 FTP 服务器，然后要求文件送到一台第三方服务器。请求 FTP 服务器轮流发送一个文件到目标主机上的所感兴趣的端口。 错误消息会描述端口是开放还是关闭的。</p>
<h1 id="服务识别"><a class="markdownIt-Anchor" href="#服务识别"></a> 服务识别</h1>
<h2 id="默认端口"><a class="markdownIt-Anchor" href="#默认端口"></a> 默认端口</h2>
<p>比较无脑的方法是默认应用不会改变其运行的默认端口，只需将端口扫描的结果与常见应用所占端口对比就可以确定该端口上运行的服务。
显然现实总不能如我们所愿，如果服务运行在奇奇怪怪的端口，或者用了别的服务的默认端口，直接查表显然是不科学的。</p>
<h2 id="banner-信息"><a class="markdownIt-Anchor" href="#banner-信息"></a> banner 信息</h2>
<p>除此之外，有一个相对简单的方式就是通过无阻塞套接字和探查，然后对响应进行匹配以期得到一个正确的探测结果，在使用 nmap 探测一个 nc 监听的端口时会发现收到了一个 GET / HTTP/1.0。
那么同样可以使用 python 的 socket 发送它来得到服务响应。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TCP端口探测（TCP服务被动识别）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">TcpPort</span>(<span class="params">ip, port</span>):</span><br><span class="line">    banner = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    status = <span class="number">0</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">        sock.settimeout(<span class="number">3</span>)</span><br><span class="line">        sock.connect((ip, port))</span><br><span class="line">        status = <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="comment"># 被动服务识别</span></span><br><span class="line">    <span class="keyword">if</span> status:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            banner = sock.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;banner&quot;</span>: banner, <span class="string">&quot;port&quot;</span>: port&#125;</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;banner&quot;</span>: banner, <span class="string">&quot;port&quot;</span>: port&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/c4ooc0/blog-image/blog/images/Fi-1aE8NjmAZsqQF6Gi0OmOq9IKn.png" alt="" />
可以看到结果中，http 服务没有返回 banner，该方法也存在局限性。</p>
<h2 id="payload"><a class="markdownIt-Anchor" href="#payload"></a> payload</h2>
<p>首先看一下 nmap 能扫出来的东西：
<img src="https://cdn.jsdelivr.net/gh/c4ooc0/blog-image/blog/images/FhVkgrolRppCmHsB5nvPhisZ1qa_.png" alt="" />
在<a target="_blank" rel="noopener" href="http://www.nmap.com.cn/doc/manual.shtm#8">Nmap 参考指南中文版</a>中提到，nmap 会使用 nmap-service-probes 文件，里面存放着不同服务的探测报文和解析识别响应的匹配表达式。正常人应该会直接使用 nmap 吧？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nmap</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">NmapScan</span>(<span class="params">targetIP, targetPort</span>):</span><br><span class="line">    <span class="comment"># 实例化PortScanner对象</span></span><br><span class="line">    nm = nmap.PortScanner()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># hosts为目标IP地址,argusments为Nmap的扫描参数</span></span><br><span class="line">        <span class="comment"># -p:对指定端口进行扫描</span></span><br><span class="line">        <span class="comment"># -sV:对端口进行服务程序探测</span></span><br><span class="line">        result = nm.scan(hosts=targetIP, arguments=<span class="string">&#x27;-sV -p&#x27;</span> + <span class="built_in">str</span>(targetPort))</span><br><span class="line">        <span class="comment"># 对结果进行切片，提取端口信息</span></span><br><span class="line">        <span class="comment"># 这里需要注意的是,提取信息时需要把端口转化为int型</span></span><br><span class="line">        port_infor = result[<span class="string">&#x27;scan&#x27;</span>][targetIP][<span class="string">&#x27;tcp&#x27;</span>][<span class="built_in">int</span>(targetPort)]</span><br><span class="line">        <span class="comment"># 分别显示  端口号：端口状态 端口服务:端口服务程序</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[&#123;&#125;:&#123;&#125;] : [&#123;&#125;:&#123;&#125;]&quot;</span>.<span class="built_in">format</span>(targetPort, port_infor[<span class="string">&#x27;state&#x27;</span>], port_infor[<span class="string">&#x27;name&#x27;</span>], port_infor[<span class="string">&#x27;product&#x27;</span>]))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(e)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.jsdelivr.net/gh/c4ooc0/blog-image/blog/images/Ftyb7oUY-TYhQe9rQpIFr2b6GHD4.png" alt="" />
当然 nmap 也有识别不准的时候，参考之前提到的博客，可以自己抓包获取 payload，针对特定服务，会更加准确些。</p>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/06/13/DVWA%20%E6%94%BB%E7%95%A5%E7%BB%8F%E5%8E%86/" rel="prev" title="DVWA 攻略经历">
                  <i class="fa fa-chevron-left"></i> DVWA 攻略经历
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/07/14/%E7%BA%A2%E6%97%A5%E9%9D%B6%E5%9C%BA1%20kali2022.2/" rel="next" title="红日靶场1 kali2022.2">
                  红日靶场1 kali2022.2 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">c4ooc0</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">19k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:09</span>
  </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"per_page":true,"tags":"none","engine":"mathjax","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="exif" type="application/json">"{FocalLength}mm f/{FNumber} {ExposureTime}s"</script>
<script src="https://fastly.jsdelivr.net/npm/exif-js@2/exif.min.js"></script>
<script src="/lib/exif.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":145,"height":315},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body>
</html>
